---
layout: post
title: 为子主题增加主题选项功能
tags:
  - 主题选项
  - 子主题
  - 子主题设置
  - 清学小记
  - 燕坊清作
abbrlink: 1465
date: 2017-02-12 00:00:00
---

<!-- build time:Sat Jun 23 2018 12:05:15 GMT+0800 (中国标准时间) -->

<span style="color:#0070c0">用子主题的好处都知道：可以在使用的主题更新后，对其的更改不会被更新覆盖掉，</span>

<span style="color:#0070c0">但是如果能为子主题增加主题选项，是不是会使子主题的使用效果更好呢，下面介绍步骤（以下仅为部分代码，后面有完整代码）：  
</span>

<span style="color:#0070c0">1、在子主题的"function.php"中增加以下代码，使外观菜单中增加"子主题选项"菜单，点击可进入对应标签页，各参数作用请看注释：</span>  

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span>  
<span class="line">2</span>  
</pre></td><td class="code"><pre><span class="line"><span class="comment">// 在后台外观导航下增加子主题设置标签页：[1]设置页的title、[2]显示在外观菜单中的标题、[3]访问这个页面需要的权限、[4]别名（出现在地址栏中：?page=XXXXXXXXX）、[5]执行的函数（设置页面包含的内容）</span></span>  
<span class="line">add_theme_page(<span class="string">"子主题设置"</span>, <span class="string">"子主题设置"</span>, <span class="string">"administrator"</span>, <span class="string">"bmqy_subTheme_opts"</span>, <span class="string">'display'</span>);</span>  
</pre></td></tr></table></figure>

<span style="color:#0070c0">效果截图：</span>

![子主题设置菜单](http://image.bmqy.net/uploads/2017/02/201702121486904799720001.png "子主题设置菜单") <span style="color:#0070c0"></span>

<span style="color:#0070c0">2、为"子主题设置"的标签页编写需要进行主题选项的html代码，举例"广告位设置"代码如下：</span>  

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span>  
<span class="line">2</span>  
<span class="line">3</span>  
<span class="line">4</span>  
<span class="line">5</span>  
<span class="line">6</span>  
<span class="line">7</span>  
<span class="line">8</span>  
<span class="line">9</span>  
<span class="line">10</span>  
<span class="line">11</span>  
<span class="line">12</span>  
<span class="line">13</span>  
<span class="line">14</span>  
<span class="line">15</span>  
<span class="line">16</span>  
<span class="line">17</span>  
<span class="line">18</span>  
<span class="line">19</span>  
<span class="line">20</span>  
<span class="line">21</span>  
<span class="line">22</span>  
<span class="line">23</span>  
<span class="line">24</span>  
<span class="line">25</span>  
<span class="line">26</span>  
<span class="line">27</span>  
<span class="line">28</span>  
<span class="line">29</span>  
<span class="line">30</span>  
<span class="line">31</span>  
<span class="line">32</span>  
<span class="line">33</span>  
<span class="line">34</span>  
<span class="line">35</span>  
<span class="line">36</span>  
<span class="line">37</span>  
</pre></td><td class="code"><pre><span class="line"><span class="comment">/* -- 子主题设置页标签面 -- */</span></span>  
<span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span>  
<span class="line">    add_thickbox();</span>  
<span class="line">    <span class="meta">?></span></span>  
<span class="line">    <div class="wrap"></span>  
<span class="line">        <h1>子主题设置项</h1></span>  
<span class="line">        <!-- 顶部推荐设置 --></span>  
<span class="line">        <form method=<span class="string">"post"</span> action=<span class="string">""</span> name=<span class="string">"bmqy_subTheme_topRecommend"</span> id=<span class="string">"bmqy_subTheme_topRecommend"</span>></span>  
<span class="line">            <span class="meta"><?php</span></span>  
<span class="line">            $bstTopRecommendOptions = get_option(<span class="string">'bmqy_subTheme_topRecommend'</span>);</span>  
<span class="line">            <span class="meta">?></span></span>  
<span class="line">            <h2>广告位设置</h2></span>  
<span class="line">            <table class="form-table"></span>  
<span class="line">                <tr></span>  
<span class="line">                    <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"topRecommendStatus"</span>>顶部广告推荐位</label></th></span>  
<span class="line">                    <td><fieldset><legend class="screen-reader-text"><span>顶部广告推荐位</span></legend><label for="topRecommendStatus"><input name="status" type="checkbox" id="topRecommendStatus" value="1" <?php checked('1', $bstTopRecommendOptions['status']); ?> />&nbsp;启用</label></fieldset></td></span>  
<span class="line">                </tr></span>  
<span class="line">                <tr></span>  
<span class="line">                    <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"topRecommendTitle"</span>>顶部广告推荐位标题</label></th></span>  
<span class="line">                    <td><input name="title" type="text" id="topRecommendTitle" value="<?php echo $bstTopRecommendOptions['title']; ?>" class="regular-text ltr" /></td></span>  
<span class="line">                </tr></span>  
<span class="line">                <tr></span>  
<span class="line">                    <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"topRecommendLink"</span>>顶部广告推荐位链接</label></th></span>  
<span class="line">                    <td><input name="link" type="text" id="topRecommendLink" value="<?php echo $bstTopRecommendOptions['link']; ?>" class="regular-text ltr" /></td></span>  
<span class="line">                </tr></span>  
<span class="line">                <tr></span>  
<span class="line">                    <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"topRecommendImage"</span>>顶部广告推荐位图片</label></th></span>  
<span class="line">                    <td><input name="image" type="text" id="topRecommendImage" aria-describedby="topRecommendImage_description" value="<?php echo $bstTopRecommendOptions['image']; ?>" class="regular-text ltr" />&nbsp;<a class="thickbox" title="插入图片" href="#">插入图片</a><p class="description" id="topRecommendImage_description">请填写图片链接地址，推荐尺寸：1198*80</p></td></span>  
<span class="line">                </tr></span>  
<span class="line">            </table></span>  
<span class="line">            <span class="meta"><?php</span> submit_button(<span class="string">'保存'</span>, <span class="string">'primary'</span>, <span class="string">'submit_bmqy_subTheme_topRecommend'</span>); <span class="meta">?></span></span>  
<span class="line">        </form></span>  
<span class="line">    </div></span>  
<span class="line">    <span class="meta"><?php</span></span>  
<span class="line">    <span class="comment">// 调用处理插入图片的方法</span></span>  
<span class="line">    send_to_editor();</span>  
<span class="line">&#125;</span>  
</pre></td></tr></table></figure>

<span style="color:#0070c0">效果截图：</span>

![子主题设置项](http://image.bmqy.net/uploads/2017/02/201702121486905260183660.png "子主题设置项")

<span style="color:#0070c0">3、增加提交数据并保存到数据库的代码：</span>  

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span>  
<span class="line">2</span>  
<span class="line">3</span>  
<span class="line">4</span>  
<span class="line">5</span>  
<span class="line">6</span>  
<span class="line">7</span>  
<span class="line">8</span>  
<span class="line">9</span>  
<span class="line">10</span>  
</pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果有提交数据，接收并保存到数据库</span></span>  
<span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit_bmqy_subTheme_topRecommend'</span>])) &#123;</span>  
<span class="line">    <span class="comment">// 接收并处理数据：顶部推荐广告位</span></span>  
<span class="line">    $bstTopRecommendOptions[<span class="string">'status'</span>] = ($_POST[<span class="string">'status'</span>]==<span class="number">1</span>) ? (bool)<span class="keyword">true</span> : (bool)<span class="keyword">false</span>;</span>  
<span class="line">    $bstTopRecommendOptions[<span class="string">'title'</span>] = $_POST[<span class="string">'title'</span>];</span>  
<span class="line">    $bstTopRecommendOptions[<span class="string">'link'</span>] = $_POST[<span class="string">'link'</span>];</span>  
<span class="line">    $bstTopRecommendOptions[<span class="string">'image'</span>] = $_POST[<span class="string">'image'</span>];</span>  
<span class="line">    <span class="comment">// 更新数据</span></span>  
<span class="line">    update_option(<span class="string">'bmqy_subTheme_topRecommend'</span>, $bstTopRecommendOptions);</span>  
<span class="line">&#125;</span>  
</pre></td></tr></table></figure>

<span style="color:#0070c0">4、增加插入图片功能的处理代码：</span>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span>  
<span class="line">2</span>  
<span class="line">3</span>  
<span class="line">4</span>  
<span class="line">5</span>  
<span class="line">6</span>  
<span class="line">7</span>  
<span class="line">8</span>  
<span class="line">9</span>  
<span class="line">10</span>  
<span class="line">11</span>  
<span class="line">12</span>  
<span class="line">13</span>  
<span class="line">14</span>  
<span class="line">15</span>  
<span class="line">16</span>  
<span class="line">17</span>  
<span class="line">18</span>  
<span class="line">19</span>  
<span class="line">20</span>  
<span class="line">21</span>  
<span class="line">22</span>  
</pre></td><td class="code"><pre><span class="line"><span class="comment">/* -- 接收并处理上传的图片信息 -- */</span></span>  
<span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send_to_editor</span><span class="params">()</span></span>&#123;</span>  
<span class="line">    <span class="meta">?></span></span>  
<span class="line">    <script></span>  
<span class="line">        jQuery(document).ready(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span>  
<span class="line">            <span class="keyword">var</span> win = window.dialogArguments '' opener '' <span class="keyword">parent</span> '' top;</span>  
<span class="line">            <span class="keyword">var</span> sendToEditorTarget;</span>  
<span class="line"></span>  
<span class="line">            jQuery(<span class="string">'.thickbox'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span>  
<span class="line">                sendToEditorTarget = jQuery(this).prev(<span class="string">'input[name=image]'</span>);</span>  
<span class="line">                tb_show(<span class="string">'请选择图片'</span>, <span class="string">'/wp-admin/media-upload.php?type=image&amp;TB_iframe=true'</span>);</span>  
<span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span>  
<span class="line">            &#125;);</span>  
<span class="line">            win.send_to_editor = <span class="function"><span class="keyword">function</span><span class="params">(html)</span> </span>&#123;</span>  
<span class="line">                imgurl = jQuery(<span class="string">'img'</span>,html).attr(<span class="string">'src'</span>);</span>  
<span class="line">                jQuery(sendToEditorTarget).val(imgurl);</span>  
<span class="line">                tb_remove();</span>  
<span class="line">            &#125;</span>  
<span class="line">        &#125;);</span>  
<span class="line">    </script></span>  
<span class="line">    <span class="meta"><?php</span></span>  
<span class="line">&#125;</span>  
</pre></td></tr></table></figure>

<span style="color:#0070c0">5、前台调用时的代码如下：</span>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span>  
<span class="line">2</span>  
<span class="line">3</span>  
<span class="line">4</span>  
<span class="line">5</span>  
<span class="line">6</span>  
<span class="line">7</span>  
<span class="line">8</span>  
<span class="line">9</span>  
<span class="line">10</span>  
<span class="line">11</span>  
<span class="line">12</span>  
<span class="line">13</span>  
</pre></td><td class="code"><pre><span class="line"><span class="meta"><?php</span></span>  
<span class="line">         <span class="comment">// 获取顶部推荐配置项</span></span>  
<span class="line">         $bstTopRecommendOptions = get_option(<span class="string">'bmqy_subTheme_topRecommend'</span>);</span>  
<span class="line">         <span class="keyword">if</span> ( $bstTopRecommendOptions[<span class="string">'status'</span>] == <span class="number">1</span>) &#123;</span>  
<span class="line">         <span class="meta">?></span></span>  
<span class="line"><!-- 顶部推荐内容 begin --></span>  
<span class="line"><div id="topRecommend" class="top-recommend"></span>  
<span class="line">   <a href=<span class="string">"<?php echo $bstTopRecommendOptions['link']; ?>"</span> title=<span class="string">"<?php echo $bstTopRecommendOptions['title']; ?>"</span>></span>  
<span class="line">      <img src=<span class="string">"<?php echo $bstTopRecommendOptions['image']; ?>"</span> alt=<span class="string">"<?php echo $bstTopRecommendOptions['title']; ?>"</span>></span>  
<span class="line">   </a></span>  
<span class="line"></div></span>  
<span class="line"><!-- 顶部推荐内容 end --></span>  
<span class="line">         <span class="meta"><?php</span> &#125; <span class="meta">?></span></span>  
</pre></td></tr></table></figure>

**<span style="color:#0070c0">6、本站点结合"露兜博客 [http://www.ludou.org/wordpress-add-theme-options.html"和"阿树工作室http://www.ashuwp.com/courses/optionpage/206.html"两位博主分享的教程编写代码如下，再次感谢两位博主的分享！感谢！](http://www.ludou.org/wordpress-add-theme-options.html"和"阿树工作室http://www.ashuwp.com/courses/optionpage/206.html"两位博主分享的教程编写代码如下，再次感谢两位博主的分享！感谢！)</span>**  

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span>  
<span class="line">2</span>  
<span class="line">3</span>  
<span class="line">4</span>  
<span class="line">5</span>  
<span class="line">6</span>  
<span class="line">7</span>  
<span class="line">8</span>  
<span class="line">9</span>  
<span class="line">10</span>  
<span class="line">11</span>  
<span class="line">12</span>  
<span class="line">13</span>  
<span class="line">14</span>  
<span class="line">15</span>  
<span class="line">16</span>  
<span class="line">17</span>  
<span class="line">18</span>  
<span class="line">19</span>  
<span class="line">20</span>  
<span class="line">21</span>  
<span class="line">22</span>  
<span class="line">23</span>  
<span class="line">24</span>  
<span class="line">25</span>  
<span class="line">26</span>  
<span class="line">27</span>  
<span class="line">28</span>  
<span class="line">29</span>  
<span class="line">30</span>  
<span class="line">31</span>  
<span class="line">32</span>  
<span class="line">33</span>  
<span class="line">34</span>  
<span class="line">35</span>  
<span class="line">36</span>  
<span class="line">37</span>  
<span class="line">38</span>  
<span class="line">39</span>  
<span class="line">40</span>  
<span class="line">41</span>  
<span class="line">42</span>  
<span class="line">43</span>  
<span class="line">44</span>  
<span class="line">45</span>  
<span class="line">46</span>  
<span class="line">47</span>  
<span class="line">48</span>  
<span class="line">49</span>  
<span class="line">50</span>  
<span class="line">51</span>  
<span class="line">52</span>  
<span class="line">53</span>  
<span class="line">54</span>  
<span class="line">55</span>  
<span class="line">56</span>  
<span class="line">57</span>  
<span class="line">58</span>  
<span class="line">59</span>  
<span class="line">60</span>  
<span class="line">61</span>  
<span class="line">62</span>  
<span class="line">63</span>  
<span class="line">64</span>  
<span class="line">65</span>  
<span class="line">66</span>  
<span class="line">67</span>  
<span class="line">68</span>  
<span class="line">69</span>  
<span class="line">70</span>  
<span class="line">71</span>  
<span class="line">72</span>  
<span class="line">73</span>  
<span class="line">74</span>  
<span class="line">75</span>  
<span class="line">76</span>  
<span class="line">77</span>  
<span class="line">78</span>  
<span class="line">79</span>  
<span class="line">80</span>  
<span class="line">81</span>  
<span class="line">82</span>  
<span class="line">83</span>  
<span class="line">84</span>  
<span class="line">85</span>  
<span class="line">86</span>  
<span class="line">87</span>  
<span class="line">88</span>  
<span class="line">89</span>  
<span class="line">90</span>  
<span class="line">91</span>  
<span class="line">92</span>  
<span class="line">93</span>  
<span class="line">94</span>  
<span class="line">95</span>  
<span class="line">96</span>  
<span class="line">97</span>  
<span class="line">98</span>  
<span class="line">99</span>  
<span class="line">100</span>  
<span class="line">101</span>  
<span class="line">102</span>  
<span class="line">103</span>  
<span class="line">104</span>  
<span class="line">105</span>  
<span class="line">106</span>  
<span class="line">107</span>  
<span class="line">108</span>  
<span class="line">109</span>  
<span class="line">110</span>  
<span class="line">111</span>  
<span class="line">112</span>  
<span class="line">113</span>  
<span class="line">114</span>  
<span class="line">115</span>  
<span class="line">116</span>  
<span class="line">117</span>  
<span class="line">118</span>  
<span class="line">119</span>  
<span class="line">120</span>  
<span class="line">121</span>  
<span class="line">122</span>  
<span class="line">123</span>  
<span class="line">124</span>  
<span class="line">125</span>  
<span class="line">126</span>  
<span class="line">127</span>  
<span class="line">128</span>  
<span class="line">129</span>  
<span class="line">130</span>  
<span class="line">131</span>  
<span class="line">132</span>  
<span class="line">133</span>  
<span class="line">134</span>  
<span class="line">135</span>  
<span class="line">136</span>  
<span class="line">137</span>  
<span class="line">138</span>  
<span class="line">139</span>  
<span class="line">140</span>  
<span class="line">141</span>  
<span class="line">142</span>  
<span class="line">143</span>  
<span class="line">144</span>  
<span class="line">145</span>  
<span class="line">146</span>  
<span class="line">147</span>  
<span class="line">148</span>  
<span class="line">149</span>  
<span class="line">150</span>  
<span class="line">151</span>  
<span class="line">152</span>  
<span class="line">153</span>  
<span class="line">154</span>  
<span class="line">155</span>  
<span class="line">156</span>  
<span class="line">157</span>  
<span class="line">158</span>  
<span class="line">159</span>  
<span class="line">160</span>  
<span class="line">161</span>  
<span class="line">162</span>  
<span class="line">163</span>  
<span class="line">164</span>  
<span class="line">165</span>  
<span class="line">166</span>  
<span class="line">167</span>  
<span class="line">168</span>  
<span class="line">169</span>  
<span class="line">170</span>  
<span class="line">171</span>  
<span class="line">172</span>  
<span class="line">173</span>  
<span class="line">174</span>  
<span class="line">175</span>  
<span class="line">176</span>  
<span class="line">177</span>  
</pre></td><td class="code"><pre><span class="line"><span class="comment">/** 子主题增加设置项 begin **/</span></span>  
<span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BmqySubThemeOptions</span> </span>&#123;</span>  
<span class="line">    <span class="comment">/* -- 初始化 -- */</span></span>  
<span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span>  
<span class="line">        <span class="comment">// 如果有提交数据，接收并保存到数据库</span></span>  
<span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit_bmqy_subTheme_topRecommend'</span>])) &#123;</span>  
<span class="line">            <span class="comment">// 接收并处理数据：顶部推荐广告位</span></span>  
<span class="line">            $bstTopRecommendOptions[<span class="string">'status'</span>] = ($_POST[<span class="string">'status'</span>]==<span class="number">1</span>) ? (bool)<span class="keyword">true</span> : (bool)<span class="keyword">false</span>;</span>  
<span class="line">            $bstTopRecommendOptions[<span class="string">'title'</span>] = $_POST[<span class="string">'title'</span>];</span>  
<span class="line">            $bstTopRecommendOptions[<span class="string">'link'</span>] = $_POST[<span class="string">'link'</span>];</span>  
<span class="line">            $bstTopRecommendOptions[<span class="string">'image'</span>] = $_POST[<span class="string">'image'</span>];</span>  
<span class="line">            <span class="comment">// 更新数据</span></span>  
<span class="line">            update_option(<span class="string">'bmqy_subTheme_topRecommend'</span>, $bstTopRecommendOptions);</span>  
<span class="line">        &#125;</span>  
<span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit_bmqy_subTheme_copyright'</span>])) &#123;</span>  
<span class="line">            <span class="comment">// 接收并处理数据：版权信息</span></span>  
<span class="line">            $bstCopyrightOptions[<span class="string">'status'</span>] = ($_POST[<span class="string">'status'</span>]==<span class="number">1</span>) ? (bool)<span class="keyword">true</span> : (bool)<span class="keyword">false</span>;</span>  
<span class="line">            $bstCopyrightOptions[<span class="string">'content_tpl'</span>] = esc_html($_POST[<span class="string">'content_tpl'</span>]); <span class="comment">// 转义提交的html</span></span>  
<span class="line">            $bstCopyrightOptions[<span class="string">'inCateList'</span>] = $_POST[<span class="string">'inCateList'</span>];</span>  
<span class="line">            <span class="comment">// 更新数据</span></span>  
<span class="line">            update_option(<span class="string">'bmqy_subTheme_copyright'</span>, $bstCopyrightOptions);</span>  
<span class="line">        &#125;</span>  
<span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit_bmqy_subTheme_taobaoShops'</span>])) &#123;</span>  
<span class="line">            <span class="comment">// 接收并处理数据：淘宝店铺</span></span>  
<span class="line">            $bstTaobaoShopsOptions[<span class="string">'status'</span>] = ($_POST[<span class="string">'status'</span>]==<span class="number">1</span>) ? (bool)<span class="keyword">true</span> : (bool)<span class="keyword">false</span>;</span>  
<span class="line">            $bstTaobaoShopsOptions[<span class="string">'title'</span>] = $_POST[<span class="string">'title'</span>];</span>  
<span class="line">            $bstTaobaoShopsOptions[<span class="string">'image'</span>] = $_POST[<span class="string">'image'</span>];</span>  
<span class="line">            $bstTaobaoShopsOptions[<span class="string">'desc'</span>] = esc_html($_POST[<span class="string">'desc'</span>]); <span class="comment">// 转义提交的html</span></span>  
<span class="line">            $bstTaobaoShopsOptions[<span class="string">'inCateList'</span>] = $_POST[<span class="string">'inCateList'</span>];</span>  
<span class="line">            <span class="comment">// 更新数据</span></span>  
<span class="line">            update_option(<span class="string">'bmqy_subTheme_taobaoShops'</span>, $bstTaobaoShopsOptions);</span>  
<span class="line">        &#125;</span>  
<span class="line"></span>  
<span class="line">        <span class="comment">// 在后台外观导航下增加子主题设置标签页：[1]设置页的title、[2]显示在外观菜单中的标题、[3]访问这个页面需要的权限、[4]别名（出现在地址栏中：?page=XXXXXXXXX）、[5]执行的函数（设置页面包含的内容）</span></span>  
<span class="line">        add_theme_page(<span class="string">"子主题设置"</span>, <span class="string">"子主题设置"</span>, <span class="string">"administrator"</span>, <span class="string">"bmqy_subTheme_opts"</span>, <span class="keyword">array</span>(<span class="string">'BmqySubThemeOptions'</span>, <span class="string">'display'</span>));</span>  
<span class="line">    &#125;</span>  
<span class="line">    <span class="comment">/* -- 接收并处理上传的图片信息 -- */</span></span>  
<span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">send_to_editor</span><span class="params">()</span></span>&#123;</span>  
<span class="line">        <span class="meta">?></span></span>  
<span class="line">        <script></span>  
<span class="line">            jQuery(document).ready(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span>  
<span class="line">                <span class="keyword">var</span> win = window.dialogArguments '' opener '' <span class="keyword">parent</span> '' top;</span>  
<span class="line">                <span class="keyword">var</span> sendToEditorTarget;</span>  
<span class="line"></span>  
<span class="line">                jQuery(<span class="string">'.thickbox'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span>  
<span class="line">                    sendToEditorTarget = jQuery(this).prev(<span class="string">'input[name=image]'</span>);</span>  
<span class="line">                    tb_show(<span class="string">'请选择图片'</span>, <span class="string">'/wp-admin/media-upload.php?type=image&amp;TB_iframe=true'</span>);</span>  
<span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span>  
<span class="line">                &#125;);</span>  
<span class="line">                win.send_to_editor = <span class="function"><span class="keyword">function</span><span class="params">(html)</span> </span>&#123;</span>  
<span class="line">                    imgurl = jQuery(<span class="string">'img'</span>,html).attr(<span class="string">'src'</span>);</span>  
<span class="line">                    jQuery(sendToEditorTarget).val(imgurl);</span>  
<span class="line">                    tb_remove();</span>  
<span class="line">                &#125;</span>  
<span class="line">            &#125;);</span>  
<span class="line">        </script></span>  
<span class="line">        <span class="meta"><?php</span></span>  
<span class="line">    &#125;</span>  
<span class="line">    <span class="comment">/* -- 子主题设置页标签面 -- */</span></span>  
<span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span>  
<span class="line">        add_thickbox();</span>  
<span class="line">        <span class="meta">?></span></span>  
<span class="line">        <div class="wrap"></span>  
<span class="line">            <h1>子主题设置项</h1></span>  
<span class="line">            <div class="catlist"></span>  
<span class="line">                <h2>网站分类ID</h2></span>  
<span class="line">                <p><span class="meta"><?php</span> <span class="keyword">echo</span> bmqy_show_category(); <span class="meta">?></span></p></span>  
<span class="line">            </div></span>  
<span class="line"></span>  
<span class="line">            <hr></span>  
<span class="line">            <!-- 顶部推荐设置 --></span>  
<span class="line">            <form method=<span class="string">"post"</span> action=<span class="string">""</span> name=<span class="string">"bmqy_subTheme_topRecommend"</span> id=<span class="string">"bmqy_subTheme_topRecommend"</span>></span>  
<span class="line">                <span class="meta"><?php</span></span>  
<span class="line">                $bstTopRecommendOptions = get_option(<span class="string">'bmqy_subTheme_topRecommend'</span>);</span>  
<span class="line">                <span class="meta">?></span></span>  
<span class="line">                <h2>广告位设置</h2></span>  
<span class="line">                <table class="form-table"></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"topRecommendStatus"</span>>顶部广告推荐位</label></th></span>  
<span class="line">                        <td><fieldset><legend class="screen-reader-text"><span>顶部广告推荐位</span></legend><label for="topRecommendStatus"><input name="status" type="checkbox" id="topRecommendStatus" value="1" <?php checked('1', $bstTopRecommendOptions['status']); ?> />&nbsp;启用</label></fieldset></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"topRecommendTitle"</span>>顶部广告推荐位标题</label></th></span>  
<span class="line">                        <td><input name="title" type="text" id="topRecommendTitle" value="<?php echo $bstTopRecommendOptions['title']; ?>" class="regular-text ltr" /></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"topRecommendLink"</span>>顶部广告推荐位链接</label></th></span>  
<span class="line">                        <td><input name="link" type="text" id="topRecommendLink" value="<?php echo $bstTopRecommendOptions['link']; ?>" class="regular-text ltr" /></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"topRecommendImage"</span>>顶部广告推荐位图片</label></th></span>  
<span class="line">                        <td><input name="image" type="text" id="topRecommendImage" aria-describedby="topRecommendImage_description" value="<?php echo $bstTopRecommendOptions['image']; ?>" class="regular-text ltr" />&nbsp;<a class="thickbox" title="插入图片" href="#">插入图片</a><p class="description" id="topRecommendImage_description">请填写图片链接地址，推荐尺寸：1198*80</p></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                </table></span>  
<span class="line">                <span class="meta"><?php</span> submit_button(<span class="string">'保存'</span>, <span class="string">'primary'</span>, <span class="string">'submit_bmqy_subTheme_topRecommend'</span>); <span class="meta">?></span></span>  
<span class="line">            </form></span>  
<span class="line"></span>  
<span class="line">            <hr></span>  
<span class="line">            <!-- 文章尾部版权信息设置 --></span>  
<span class="line">            <form method=<span class="string">"post"</span> action=<span class="string">""</span> name=<span class="string">"bmqy_subTheme_copyright"</span> id=<span class="string">"bmqy_subTheme_copyright"</span>></span>  
<span class="line">                <span class="meta"><?php</span></span>  
<span class="line">                $bstCopyrightOptions = get_option(<span class="string">'bmqy_subTheme_copyright'</span>);</span>  
<span class="line">                <span class="comment">// 默认设置</span></span>  
<span class="line">                <span class="keyword">if</span>(!is_array($bstCopyrightOptions))&#123;</span>  
<span class="line">                    $bstCopyrightOptions[<span class="string">'status'</span>] = <span class="keyword">true</span>;</span>  
<span class="line">                    $bstCopyrightOptions[<span class="string">'content_tpl'</span>] = esc_html(<span class="string">'注：原创文章，转载请注明出自 <a href="" title="">⟪⟫</a> ，Thank you！'</span>);</span>  
<span class="line">                    $bstCopyrightOptions[<span class="string">'inCateList'</span>] = <span class="string">'12,15,22,45,52,154'</span>;</span>  
<span class="line">                &#125;</span>  
<span class="line">                <span class="meta">?></span></span>  
<span class="line">                <h2>文章尾部版权信息设置</h2></span>  
<span class="line">                <table class="form-table"></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"copyrightStatus"</span>>版全信息</label></th></span>  
<span class="line">                        <td><fieldset><legend class="screen-reader-text"><span>版全信息</span></legend><label for="copyrightStatus"><input name="status" type="checkbox" id="copyrightStatus" value="1" <?php checked('1', $bstCopyrightOptions['status']); ?> />&nbsp;启用</label></fieldset></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"copyrightContentTpl"</span>>版全信息模板</label></th></span>  
<span class="line">                        <td><input name="content_tpl" type="text" id="copyrightContentTpl" aria-describedby="copyrightContentTpl_description" value="<?php echo stripslashes($bstCopyrightOptions['content_tpl']); ?>" class="regular-text ltr" /><p class="description" id="copyrightContentTpl_description">版权信息模板：为文章标题、为文章链接</p></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"copyrightInCateList"</span>>启用的文章分类ID</label></th></span>  
<span class="line">                        <td><input name="inCateList" type="text" id="copyrightInCateList" aria-describedby="copyrightInCateList_description" value="<?php echo $bstCopyrightOptions['inCateList']; ?>" class="regular-text ltr" /><p class="description" id="copyrightInCateList_description">设置哪些分类的文章下显示，多个ID以英文逗号分隔</p></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                </table></span>  
<span class="line">                <span class="meta"><?php</span> submit_button(<span class="string">'保存'</span>, <span class="string">'primary'</span>, <span class="string">'submit_bmqy_subTheme_copyright'</span>); <span class="meta">?></span></span>  
<span class="line">            </form></span>  
<span class="line"></span>  
<span class="line">            <hr></span>  
<span class="line">            <!-- 文章尾部淘宝店铺设置 --></span>  
<span class="line">            <form method=<span class="string">"post"</span> action=<span class="string">""</span> name=<span class="string">"bmqy_subTheme_taobaoShops"</span> id=<span class="string">"bmqy_subTheme_taobaoShops"</span>></span>  
<span class="line">                <span class="meta"><?php</span></span>  
<span class="line">                $bstTaobaoShopsOptions = get_option(<span class="string">'bmqy_subTheme_taobaoShops'</span>);</span>  
<span class="line">                <span class="comment">// 默认设置</span></span>  
<span class="line">                <span class="keyword">if</span>(!is_array($bstTaobaoShopsOptions))&#123;</span>  
<span class="line">                    $bstTaobaoShopsOptions[<span class="string">'status'</span>] = <span class="keyword">true</span>;</span>  
<span class="line">                    $bstTaobaoShopsOptions[<span class="string">'title'</span>] = <span class="string">'北门清燕淘宝小店'</span>;</span>  
<span class="line">                    $bstTaobaoShopsOptions[<span class="string">'image'</span>] = <span class="string">'http://gqrcode.alicdn.com/img?type=cs&shop_id=117869181&seller_id=279690537&w=140&h=140&el=q&v=1'</span>;</span>  
<span class="line">                    $bstTaobaoShopsOptions[<span class="string">'desc'</span>] = <span class="string">'<h5>北门清燕仿站服务</h5></span></span>  
<span class="line"><span class="string">                  <p>扫一扫，去淘宝小店下单吧</p><p>我的淘宝小店，优惠活动进行中，欢迎来店洽谈咨询哦！</p></span></span>  
<span class="line"><span class="string">                  <p><a rel="nofollow" href="http://shop117869181.taobao.com/" title="北门清燕淘宝小店">立即进店</a>，或者在这里留言给我。</p>'</span>;</span>  
<span class="line">                    $bstTaobaoShopsOptions[<span class="string">'inCateList'</span>] = <span class="string">'248'</span>;</span>  
<span class="line">                &#125;</span>  
<span class="line">                <span class="meta">?></span></span>  
<span class="line">                <h2>文章尾部淘宝店铺设置</h2></span>  
<span class="line">                <table class="form-table"></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"taobaoShopsStatus"</span>>淘宝店铺</label></th></span>  
<span class="line">                        <td><fieldset><legend class="screen-reader-text"><span>淘宝店铺</span></legend><label for="taobaoShopsStatus"><input name="status" type="checkbox" id="taobaoShopsStatus" value="1" <?php checked('1', $bstTaobaoShopsOptions['status']); ?> />&nbsp;启用</label></fieldset></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"taobaoShopsTitle"</span>>淘宝店铺标题</label></th></span>  
<span class="line">                        <td><input name="title" type="text" id="taobaoShopsTitle" value="<?php echo $bstTaobaoShopsOptions['title']; ?>" class="regular-text ltr" /></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"taobaoShopsImage"</span>>淘宝店铺图片</label></th></span>  
<span class="line">                        <td><input name="image" type="text" id="taobaoShopsImage" aria-describedby="image_description" value="<?php echo $bstTaobaoShopsOptions['image']; ?>" class="regular-text ltr" />&nbsp;<a class="thickbox" title="插入图片" href="/wp-admin/media-upload.php?type=image&amp;TB_iframe=true">插入图片</a><p class="description" id="taobaoShopsImage_description">请填写淘宝店铺二维码图片地址，推荐尺寸：140*140</p></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"taobaoShopsDesc"</span>>淘宝店铺描述</label></th></span>  
<span class="line">                        <td><textarea name="desc" id="taobaoShopsDesc" aria-describedby="taobaoShopsDesc_description" rows="10" cols="50" class="regular-text code"><?php echo stripslashes($bstTaobaoShopsOptions['desc']); ?></textarea><p class="description" id="taobaoShopsDesc_description">可填加html标签，最终以显示 3 行为宜</p></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                    <tr></span>  
<span class="line">                        <th scope=<span class="string">"row"</span>><label <span class="keyword">for</span>=<span class="string">"taobaoShopsInCateList"</span>>启用的文章分类ID</label></th></span>  
<span class="line">                        <td><input name="inCateList" type="text" id="taobaoShopsInCateList" aria-describedby="taobaoShopsInCateList_description" value="<?php echo $bstTaobaoShopsOptions['inCateList']; ?>" class="regular-text ltr" /><p class="description" id="taobaoShopsInCateList_description">设置哪些分类的文章下显示，多个ID以英文逗号分隔</p></td></span>  
<span class="line">                    </tr></span>  
<span class="line">                </table></span>  
<span class="line">                <span class="meta"><?php</span> submit_button(<span class="string">'保存'</span>, <span class="string">'primary'</span>, <span class="string">'submit_bmqy_subTheme_taobaoShops'</span>); <span class="meta">?></span></span>  
<span class="line">            </form></span>  
<span class="line">        </div></span>  
<span class="line">        <span class="meta"><?php</span></span>  
<span class="line">        <span class="comment">// 调用处理插入图片的方法</span></span>  
<span class="line">        BmqySubThemeOptions::send_to_editor();</span>  
<span class="line">    &#125;</span>  
<span class="line">&#125;</span>  
<span class="line"><span class="comment">// 注册并初始化方法</span></span>  
<span class="line">add_action(<span class="string">'admin_menu'</span>, <span class="keyword">array</span>(<span class="string">'BmqySubThemeOptions'</span>, <span class="string">'init'</span>));</span>  
<span class="line"><span class="comment">/** 子主题增加设置项 end **/</span></span>  
</pre></td></tr></table></figure>

<span style="color:#0070c0">整体效果截图：</span>

![子主题设置项](http://image.bmqy.net/uploads/2017/02/201702121486906693366680.png "子主题设置项")

<span style="color:#0070c0">7、参考以上设置，相信您能让您的子主题功能更加强大o( _≧▽≦)ツ，最后再次感谢所有分享代码的朋友们，感谢o(_≧▽≦)ツ</span>
<!-- rebuild by neat -->